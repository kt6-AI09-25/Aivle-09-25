<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>테스트 페이지</title>
  <link rel="stylesheet" href="css/style.css">
  <style>
    #myVideo {
        display: block;
        margin: 20px auto;
        border: 2px solid black;
    }
    .controls {
        text-align: center;
        margin-top: 10px;
    }
    /* 로딩 화면 스타일 */
    #loadingModal {
        display: none; /* 기본적으로 숨김 */
        position: fixed;
        z-index: 2; /* 모달보다 위에 표시 */
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5); /* 반투명 배경 */
        color: white;
        text-align: center;
        padding-top: 20%;
        font-size: 24px;
    }
  </style>
</head>
<body>
<!-- 비디오 화면 -->
<video id="myVideo" width="900" height="500" autoplay playsinline></video>

<!-- 버튼 컨트롤 -->
<div class="controls">
  <button id="startBtn">발표 시작</button>
  <button id="stopBtn">발표 중지</button>
  <button id="viewResultsBtn">분석 결과 보기</button>
</div>

<!-- 로딩 화면 -->
<div id="loadingModal">당신의 발표를 분석중입니다.</div>

<script>
  let stream;

  // 웹캠 스트림 가져오기
  async function startCamera() {
      try {
          const video = document.getElementById('myVideo');
          stream = await navigator.mediaDevices.getUserMedia({
              video: { width: 900, height: 500 },
              audio: false
          });
          video.srcObject = stream;
          console.log("카메라가 시작되었습니다.");
      } catch (error) {
          console.error("카메라 접근 실패:", error);
          alert("카메라에 접근할 수 없습니다: " + error.message);
      }
  }

  // 스트림 중지
  function stopCamera() {
      if (stream) {
          const tracks = stream.getTracks();
          tracks.forEach(track => track.stop());
          stream = null;
          const video = document.getElementById('myVideo');
          video.srcObject = null;
          console.log("카메라가 중지되었습니다.");
      }
  }

  // 분석 결과 보기 버튼 클릭 시 로딩 화면 표시 후 페이지 이동
  document.getElementById('viewResultsBtn').addEventListener('click', function() {
      document.getElementById('loadingModal').style.display = 'block'; // 로딩 화면 표시
      setTimeout(function() {
          window.location.href = '/result'; // 분석 결과 페이지로 이동
      }, 1000); // 1초 후 페이지 이동
  });

  // 페이지 로드 시 로딩 화면 항상 숨김
  window.onload = function() {
      document.getElementById('loadingModal').style.display = 'none'; // 로딩 화면 숨기기
  };

  // 이벤트 핸들러 연결
  document.getElementById('startBtn').addEventListener('click', startCamera);
  document.getElementById('stopBtn').addEventListener('click', stopCamera);
</script>
</body>
</html>
