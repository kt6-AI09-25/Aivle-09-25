<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8"/>
    <title>관리자 페이지 - 메인</title>
    <link rel="stylesheet" href="/css/admin.css">
    <link rel="stylesheet" href="/css/style.css">
    <style>
        /* 대시보드용 간단한 카드 스타일 */

        .online-users {
          background-color: #fff;
          padding: 20px;
          border-radius: 8px;
          box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .online-users h3 {
          margin-bottom: 15px;
          font-size: 1.2rem;
          color: #333;
        }

        /* 최근 활동 섹션 예시 */
        .recent-activities {
          background-color: #fff;
          padding: 20px;
          border-radius: 8px;
          box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .recent-activities h3 {
          margin-bottom: 15px;
          font-size: 1.2rem;
          color: #333;
        }
        .activities-list {
          list-style: none;
          margin: 0;
          padding: 0;
        }
        .activities-list li {
          padding: 10px 0;
          border-bottom: 1px solid #eee;
        }
        .activities-list li:last-child {
          border-bottom: none;
        }
        .activity-title {
          font-weight: bold;
          margin-right: 5px;
        }
        .activity-time {
          color: #999;
          font-size: 0.9rem;
        }
    </style>
</head>
<body>
<div th:replace="navbar.html"></div>
<div class="admin-container">
    <!-- 사이드바 -->
    <div class="sidebar">
        <h2>Admin</h2>
        <ul class="menu">
            <li><a href="/admin" class="active">메인</a></li>
            <li><a href="/admin/members">회원 관리</a></li>
            <li><a href="/admin/report">게시판 신고 관리</a></li>
            <li><a href="presentations.html">발표 내용 조회</a></li>
            <li><a href="statistics.html">통계 페이지</a></li>
        </ul>

        <footer class="sidebar-footer">
            <!-- 홈페이지 링크 -->
            <a href="/">홈페이지로 돌아가기</a>
        </footer>
    </div>

    <!-- 메인 컨텐츠 영역 -->
    <div class="content">
        <h1 class="page-title">관리자 메인 페이지</h1>
        <div class="title-line"></div>

        <!-- 카드 형태의 주요 지표 -->
        <div class="dashboard-cards">
            <!-- <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<2025-02-03 10:40 박청하<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< -->
            <div class="card">
                <h3>전체 회원 수</h3>
                <p id="total-users">로딩 중...</p>
            </div>
            <div class="card">
                <h3>오늘 신규 가입</h3>
                <p id="today-joined">로딩 중...</p>
            </div>
            <div class="card">
                <h3>미처리 신고</h3>
                <p id="unprocessed-reports">로딩 중...</p>
            </div>
            <div class="card">
                <h3>발표 등록 수</h3>
                <p id="total-posts">로딩 중...</p>
            </div>
            <!-- >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>2025-02-03 10:40 박청하>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> -->
        </div>

        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <div class="dashboard-cards">

            <div class="chart-card">
                <h3>차트1</h3>
                <div class="chart-container">
                    <canvas id="myChart"></canvas>
                </div>
            </div>

            <div class="chart-card">
                <h3>등수</h3>
                <li>
                    <span>길동</span>
                </li>
                <li>
                    <span>길동</span>
                </li>
                <li>
                    <span>길동</span>
                </li>
                <li>
                    <span>길동</span>
                </li>
            </div>

            <div class="chart-card">
                <h3>등수</h3>
                <ul class="activities-list">
                <li>
                    <span>길동</span>
                </li>
                <li>
                    <span>길동</span>
                </li>
                <li>
                    <span>길동</span>
                </li>
                <li>
                    <span>길동</span>
                </li>
                </ul>
            </div>
        </div>

        <div class="dashboard-cards">

            <div class="chart-card">
                <h3>차트2</h3>
                <div class="chart-container">
                    <canvas id="myChart2"></canvas>
                </div>
            </div>

            <div class="chart-card">
                <h3>접속중인 회원</h3>
                <ul id="activeUsersList" class="users-list">
                    <li>로딩 중...</li>
                </ul>
            </div>
        </div>

        <div class="recent-activities">
                    <h3>최근 활동</h3>
                    <ul id="activityList" class="activities-list">
                        <li>로딩 중...</li>
                    </ul>
        </div>
      
        <script>
            window.onload = () => {
              const ctx = document.getElementById('myChart').getContext('2d');
              new Chart(ctx, {
                type: 'bar',
                data: {
                  labels: ['01-20','01-21','01-22','01-23','01-24','01-25','01-26'],
                  datasets: [{
                    label: '일일 가입자 수',
                    data: [3,4,2,6,5,7,5],
                    backgroundColor: 'rgba(54, 162, 235, 0.7)'
                  }]
                },
                options: {
                  responsive: true,
                  scales: {
                    y: {
                      beginAtZero: true
                    }
                  }
                }
              });
            }
            //<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<2025-02-03 10:40 박청하<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<

            async function fetchUserStats() {
                try {
                    const response = await fetch('/admin/statistics');
                    if (!response.ok) {
                        throw new Error('데이터를 불러오는 데 실패했습니다.');
                    }

                    const data = await response.json();

                    // 받아온 데이터를 화면에 반영
                    document.getElementById('total-users').textContent = `${data.totalUsers}명`;
                    document.getElementById('today-joined').textContent = `${data.todayJoinedUsers}명`;
                    document.getElementById('unprocessed-reports').textContent = `${data.unprocessedReports}건`;
                    document.getElementById('total-posts').textContent = `${data.totalPosts}건`;

                } catch (error) {
                    console.error('회원 데이터 가져오기 오류:', error);
                    document.getElementById('total-users').textContent = '불러오기 실패';
                    document.getElementById('today-joined').textContent = '불러오기 실패';
                }
            }

            // 페이지 로딩 후 데이터 가져오기
            document.addEventListener('DOMContentLoaded', fetchUserStats);

            //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>2025-02-03 10:40 박청하>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
        </script>

        <script>
            async function fetchRecentActivities() {
                try {
                    const response = await fetch('/admin/recent-activities');
                    if (!response.ok) throw new Error('데이터를 불러오는 데 실패했습니다.');

                    const activities = await response.json();
                    const activityList = document.getElementById("activityList");
                    activityList.innerHTML = ""; // 기존 목록 초기화

                    if (activities.length === 0) {
                        activityList.innerHTML = "<li>최근 활동 내역이 없습니다.</li>";
                        return;
                    }

                    activities.forEach(activity => {
                        const listItem = document.createElement("li");
                        let link = activity.targetId ? `<a href="/posts/${activity.targetId}">게시글 보기</a>` : "";
                        listItem.innerHTML = `<strong>${activity.username}</strong>님이 ${activity.action} ${link} - <span class="activity-time">${activity.createdAt}</span>`;
                        activityList.appendChild(listItem);
                    });
                } catch (error) {
                    console.error("최근 활동 불러오기 실패:", error);
                    document.getElementById("activityList").innerHTML = "<li>활동 내역을 불러오는 중 오류가 발생했습니다.</li>";
                }
            }

            // 페이지 로딩 시 데이터 가져오기
            document.addEventListener("DOMContentLoaded", fetchRecentActivities);
        </script>

    </div>
</div>
</body>
</html>
